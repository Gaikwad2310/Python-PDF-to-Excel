import streamlit as st
import pandas as pd
from st_aggrid import AgGrid, GridOptionsBuilder, GridUpdateMode

# Sample dataframe
data = {
    "ID": [101, 102, 103],
    "Name": ["Alice", "Bob", "Charlie"],
    "Score": [88, 92, 79]
}
df = pd.DataFrame(data)

st.write("### Click on any cell in the table below:")

# Build grid options with cell click enabled
gb = GridOptionsBuilder.from_dataframe(df)
gb.configure_default_column(editable=False, filter=True, sortable=True)

# Enable single cell selection
gb.configure_grid_options(singleClickEdit=False)
gb.configure_selection(selection_mode='single', use_checkbox=False, rowMultiSelectWithClick=False)

gridOptions = gb.build()

# Display the grid with cell selection enabled
grid_response = AgGrid(
    df,
    gridOptions=gridOptions,
    update_mode=GridUpdateMode.CELL_CLICKED,  # Update on cell click
    allow_unsafe_jscode=True,
    theme='blue',
    height=250,
    fit_columns_on_grid_load=True,
)

# The cell clicked info is in 'lastClickedCell' key of grid_response['data'] is just the dataframe,
# but selection is in 'selected_rows', for cell click use grid_response['last_clicked_cell']

last_clicked = grid_response.get('last_clicked_cell', None)

if last_clicked:
    row = last_clicked['rowIndex']
    col = last_clicked['column']['colId']
    value = df.iloc[row][col]
    st.success(f"You clicked cell at row {row}, column '{col}' with value: **{value}**")
else:
    st.info("Click any cell in the table above to see its value here.")
